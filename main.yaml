---
- name: Setup developer machine on Ubuntu
  hosts: all
  become: yes

  vars:
    docker_users:
      - maladroitthief
    dotfiles_repo: "https://github.com/maladroitthief/dotfiles"
    dotfiles_repo_version: main
    dotfiles_repo_accept_hostkey: true
    dotfiles_repo_local_destination: "~/workspace/dotfiles"

    dotfiles_home: "~"
    dotfiles_files:
      - .inputrc
      - .gitignore
      - .gitconfig
      - .tmux.conf

    aliases:
      - alias vim="nvim"
      - alias vi="nvim"

  pre_tasks:
    - name: "Update repo cache"
      ansible.builtin.apt:
        update_cache: yes

    - name: "Upgrade packages"
      ansible.builtin.apt:
        upgrade: "yes"

    - name: "Remove useless packages"
      ansible.builtin.apt:
        autoclean: yes

    - name: "Remove old dependencies"
      ansible.builtin.apt:
        autoremove: yes

    - name: Install neovim
      ansible.builtin.apt:
        name: neovim
        state: present

    - name: Install tmux
      ansible.builtin.apt:
        name: tmux
        state: present

    - name: Install curl
      ansible.builtin.apt:
        name: curl
        state: present

  roles:
    - geerlingguy.git
    - geerlingguy.dotfiles
    - geerlingguy.docker

  tasks:
    - name: Create the neovim directory if it does not exist
      become: no
      ansible.builtin.file:
        path: ~/.config/nvim
        state: directory

    - name: Setup neovim dotfiles
      include_role:
        name: geerlingguy.dotfiles
      vars:
        dotfiles_repo_local_destination: "~/workspace/neovim_dotfiles"
        dotfiles_home: "~/.config/nvim"
        dotfiles_files:
          - init.vim

    - name: Download k3s installer
      get_url:
        url: https://get.k3s.io
        dest: /tmp/k3s_installer.sh
        mode: 0755

    - name: Execute the k3s_installer.sh
      shell: /tmp/k3s_installer.sh

    - name: Remove the k3s_installer.sh
      file:
        path: /tmp/k3s_installer.sh
        state: absent

    - name: Install node
      community.general.snap:
        name: node
        state: present
        classic: yes

    - name: Install postman
      community.general.snap:
        name: postman
        state: present

    - name: Install gimp
      community.general.snap:
        name: gimp
        state: present

    - name: Install powershell
      community.general.snap:
        name: powershell
        state: present
        classic: yes

    - name: Install vscode
      community.general.snap:
        name: code
        state: present
        classic: yes

    - name: Install chrome
      ansible.builtin.apt:
        deb: https://dl.google.com/linux/direct/google-chrome-stable_current_amd64.deb

    - name: Install spotify
      community.general.snap:
        name: spotify
        state: present

    - name: Install discord
      community.general.snap:
        name: discord
        state: present

    - name: Setup aliases in bashrc
      ansible.builtin.lineinfile:
        path: ~/.bashrc
        line: "{{ item }}"
        insertafter: alias.*
      loop: "{{ aliases }}"

  # TODO => JetBrainsMono font install
